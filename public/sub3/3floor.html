<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Iot実習2班</title>
</head>
<body>
    <nav><p><a href="../index.html">メインページへ</a></p></nav>
    <header>
        <dev class="LockImage">
            <p>三階奥</p>
            <img id="main_1" src="/image/error_Lock.png" width="240px" height="240px" alt="鍵の画像">
        </dev>
        <dev class="LockImage">
            <p>三階中央</p>
            <img id="main_2" src="/image/error_Lock.png" width="240px" height="240px" alt="鍵の画像">
        </dev>
        <dev class="LockImage">
            <p>三階手前</p>
            <img id="main_3" src="/image/error_Lock.png" width="240px" height="240px" alt="鍵の画像">
        </dev>
    </header>
    <p><a href="https://oecu-iot02-lockcheck.herokuapp.com/sub3/3floor.html">つながらないときは</a></p>
    <script>
        console.log(document.URL);
        if(document.URL === 'https://www.izumain.net/sub3/3floor.html'){
            let url = 'https://www.izumain.net/api/locks_data';
        }else{
            let url = "https://oecu-iot02-lockcheck.herokuapp.com/api/locks_data";
        }
    let ip = 0;
    
    let check = false;
    let main_ip;
    const Lock_image = ["/image/Lock.png"];
    const NO_Lock_image = ["/image/no_Lock.png"]

function Reroad_Api(){
    
    fetch(url)
    .then(response => response.json())
    .then(data => {
    console.log(data);
    let Data_Json = data;
    //Data_Json = Data_Json['lock'];
    console.log(Data_Json.lock);
    for(let i = 1;i <= 3;i++){
        document.getElementById('main_' + String(i)).textContent = (Data_Json.find((c) => c.id === parseInt(i)).lock);
        if((Data_Json.find((c) => c.id === parseInt(i)).lock) === 'no'){
            document.getElementById('main_' + String(i)).src = Lock_image;
        }else{
            document.getElementById('main_' + String(i)).src = NO_Lock_image;
        }
        check = true;
    }
    }).catch(/*() => url = "https://oecu-iot02-lockcheck.herokuapp.com/api/locks_data"*/)
    
}



setInterval("Reroad_Api()", 500);
</script>
</body>
</html>